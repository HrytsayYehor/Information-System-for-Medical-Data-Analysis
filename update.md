# Інструкція з оновлення проєкту (Update Guide)

Цей документ містить покрокову інструкцію для оновлення Information System for Medical Data Analysis у production-середовищі.

## 1. Підготовка до оновлення

- Переконайтесь, що у вас є остання версія коду на основній гілці (`main` або `master`).
- Попередьте користувачів про можливий простій системи.
- Підготуйте середовище для відновлення у разі невдалого оновлення.

## 2. Створення резервних копій

- Створіть повну резервну копію:
  - Бази даних (наприклад, за допомогою `pg_dump` або `sqlite3 .dump`).
  - Конфігураційних файлів (наприклад, `.env`, `config.yaml`).
  - Користувацьких даних (файли, що зберігаються у файловій системі).
  - Логів (за потреби).

## 3. Перевірка сумісності

- Перевірте, що нова версія програмного забезпечення сумісна з поточним середовищем (версії Python, Streamlit, FAISS, Torch, SentenceTransformers тощо).
- Ознайомтесь з нотатками до релізу (release notes), якщо вони є.

## 4. Планування часу простою

- Якщо оновлення вимагає зупинки сервісу, заплануйте вікно простою та повідомте відповідальних осіб.

## 5. Процес оновлення

### 5.1 Зупинка служб
- Зупиніть поточний інстанс додатку (наприклад: `systemctl stop app.service` або зупинка docker-контейнера).

### 5.2 Розгортання нового коду
- Оновіть код з репозиторію:
  ```bash
  git pull origin main
  ```
- (опційно) Перевірте зміни:
  ```bash
  git log
  ```

### 5.3 Міграція даних (якщо потрібно)
- Якщо структура бази даних змінилася, застосуйте відповідні скрипти міграції.

### 5.4 Оновлення конфігурацій
- Перевірте та оновіть `.env` або інші конфігураційні файли.

### 5.5 Перезапуск додатку
- Запустіть оновлений додаток:
  ```bash
  streamlit run app.py
  ```
  або через систему процесів (наприклад, `systemctl start app.service` або запуск контейнера).

## 6. Перевірка після оновлення

- Переконайтесь, що інтерфейс додатку доступний.
- Виконайте кілька базових запитів, щоб перевірити працездатність RAG-системи.
- Перевірте логи на наявність помилок.

## 7. Відкат (Rollback) у разі невдалого оновлення

- Зупиніть поточну версію:
  ```bash
  systemctl stop app.service
  ```
- Відновіть резервні копії:
  - Базу даних
  - Конфігурації
  - Дані користувачів
- Запустіть попередню стабільну версію:
  ```bash
  git checkout <commit_id>
  streamlit run app.py
  ```

> **Порада**: ведіть журнал оновлень (changelog) для кожного релізу.